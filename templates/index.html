<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>What's for Dinner?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Add dark mode support to Tailwind
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <style>
      /* small helpers */
      .line-clamp-2 {
        display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; overflow: hidden;
      }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-100">

    <div class="max-w-4xl mx-auto p-6">

        <header class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold">What's for Dinner?</h1>
            <div class="flex gap-3 items-center">
                <button id="theme-toggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-xl">
                    </button>
                
                <a href="{{ url_for('surprise') }}"
                   class="px-4 py-2 rounded-lg bg-emerald-500 text-white shadow hover:opacity-95">
                    Surprise me!
                </a>
            </div>
        </header>

        <main>

            <section class="mb-6">
                <h2 class="text-xl font-semibold mb-3">Picked</h2>
                <div class="min-h-[140px] flex items-center justify-center border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    
                    {% if picked_recipe %}
                    <div class="max-w-2xl w-full">
                        <div class="flex gap-4 items-center">
                            <img src="{{ picked_recipe.photo }}" alt="{{ picked_recipe.title }}"
                                 class="w-28 h-20 object-cover rounded-md shadow-sm" />
                            <div>
                                <div class="font-bold text-lg">{{ picked_recipe.title }}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2">
                                    {{ picked_recipe.steps }}
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex gap-2">
                            <a href="{{ url_for('home') }}" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded">
                                Clear
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-gray-500 dark:text-gray-400">
                        No pick yet â€” click "Surprise me!"
                    </div>
                    {% endif %}

                </div>
            </section>

            <section class="mb-6">
                <h2 class="text-xl font-semibold mb-3">Add a New Recipe</h2>
                <form action="{{ url_for('add_recipe') }}" method="POST"
                      class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-3">
                    <input
                        name="title"
                        class="w-full border rounded p-2 bg-white dark:bg-gray-700 dark:border-gray-600"
                        placeholder="Recipe Title (required)"
                        required
                    />
                    <input
                        name="photo"
                        class="w-full border rounded p-2 bg-white dark:bg-gray-700 dark:border-gray-600"
                        placeholder="Photo URL (optional)"
                    />
                    <textarea
                        name="ingredients"
                        rows="3"
                        class="w-full border rounded p-2 bg-white dark:bg-gray-700 dark:border-gray-600"
                        placeholder="Ingredients (one per line)"
                    ></textarea>
                    <textarea
                        name="steps"
                        rows="3"
                        class="w-full border rounded p-2 bg-white dark:bg-gray-700 dark:border-gray-600"
                        placeholder="Steps / short recipe"
                    ></textarea>
                    <div class="text-right">
                        <button type="submit" class="px-4 py-2 rounded-lg bg-violet-600 text-white shadow">
                            + Add recipe
                        </button>
                    </div>
                </form>
            </section>

            <section>
                <h2 class="text-xl font-semibold mb-3">My Recipes</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    
                    {% for recipe in recipes %}
                    <article class="bg-white dark:bg-gray-800 rounded-lg shadow p-3 flex gap-3 items-start">
                        <img src="{{ recipe.photo }}" alt="{{ recipe.title }}"
                             class="w-28 h-20 object-cover rounded-md flex-shrink-0" />
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h3 class="font-semibold">{{ recipe.title }}</h3>
                                <a href="{{ url_for('delete_recipe', recipe_id=recipe.id) }}"
                                   class="text-sm text-red-500 hover:underline"
                                   onclick="return confirm('Are you sure you want to delete this?');">
                                    Remove
                                </a>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mt-2 font-medium">Ingredients</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 whitespace-pre-line">
                                {{ recipe.ingredients }}
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mt-2 font-medium">Steps</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 whitespace-pre-line">
                                {{ recipe.steps }}
                            </p>
                        </div>
                    </article>
                    {% endfor %}

                    {% if not recipes %}
                    <p class="text-gray-500 dark:text-gray-400 col-span-1 sm:col-span-2 text-center py-8">
                        No recipes yet. Add one above!
                    </p>
                    {% endif %}

                </div>
            </section>
        </main>
    </div>

    <script>
      const themeToggle = document.getElementById('theme-toggle');
      const doc = document.documentElement;
      const THEME_KEY = 'whats-for-dinner-theme-v1';

      // 1. Function to set the theme
      function applyTheme(isDark) {
        if (isDark) {
          doc.classList.add('dark');
          themeToggle.textContent = 'â˜€ï¸';
        } else {
          doc.classList.remove('dark');
          themeToggle.textContent = 'ðŸŒ™';
        }
      }

      // 2. Load saved theme
      let isDarkMode = localStorage.getItem(THEME_KEY) === 'dark';
      // Or check system preference
      if (localStorage.getItem(THEME_KEY) === null) {
          isDarkMode = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
      }
      applyTheme(isDarkMode);

      // 3. Toggle theme on click
      themeToggle.addEventListener('click', () => {
        isDarkMode = !isDarkMode;
        localStorage.setItem(THEME_KEY, isDarkMode ? 'dark' : 'light');
        applyTheme(isDarkMode);
      });
    </script>
</body>
</html>